# Download Virtualbox
# https://www.virtualbox.org/wiki/Downloads

# Download Ubuntu or Centos Virtual Disk Image (VDI)

# osboxes.org has many
# http://www.osboxes.org/ubuntu/
# http://www.osboxes.org/centos/
# 
# Username: osboxes
# Password: osboxes.org

# Extract 7zipped VDI file, move to desired location
# if your OS doesn't have a 7zip utility installed, you can download one from 7-zip.org
# 7za e <archive file>, or on Mac OS X, you could double click on the .7z file if using Keka

# Immediately following are instructions for the Virtualbox GUI. Command line instructions are at the end.

# Launch VirtualBox, press New button

# Name: k_grok-<username>, Type: Linux, etc.
# Use an existing virtual hard disk file, click on folder symbol to the right of the drop-down menu

# Do not power on the VM yet. Otherwise you cannot change Machine Settings
# [Virtualbox or File]->Preferences, Network, Host-only Networks, right top +
# Machine->Settings,
# System, Processors: 2, etc., whatever
# Network, Adapter 2, Enable, Attached to: Host-only Adapter

# Power on VM

# Log in as root, using password 'osboxes.org'

# Change passwords for root user and osboxes user. You can do this as root with these commands:
# passwd
# passwd osboxes

# Boot into multi-user (non-graphical mode) by default

# ln -sf /lib/systemd/system/multi-user.target /etc/systemd/system/default.target 

# If Ubuntu, then:
# click on Ubuntu button and search for "term" to get the terminal
# sudo apt-get update
# apt-get install openssh-server

# If Centos, then:
# right click on desktop, open terminal
# edit /etc/sysconfig/network-scripts/ifcfg-enp0s3 to make it look like this:
# TYPE=Ethernet
# BOOTPROTO=dhcp
# DEFROUTE=yes
# NAME=enp0s3
# UUID=<USE THE UUID IN YOUR FILE>
# DEVICE=enp0s3
# ONBOOT=yes
# service network restart
# ifconfig | grep -A2 enp0 | grep 192

# ssh from your host to your VM as user osboxes to the IP address you just grepped

# Assuming you have downloaded a compressed osbox image into $VMDIR,
# and then uncompressed it with a command such as the following:
# p7zip -d Ubuntu_16.10_Yakkety-VB-64bit.7z

export VM_DISK_DIR=$HOME/vm_disks
export VDI="$VM_DISK_DIR/Ubuntu 16.10 Yakkety (64bit).vdi"
export VMNAME=k_grok
# determine your host's primary network adapter ... this may work
export HOST_ADAPTER=$(ip link show up | grep "<BROAD" | cut -f2 -d":")

# For more info about these instructions, see:
# https://www.virtualbox.org/manual/ch08.html
# http://www.howopensource.com/2011/06/how-to-use-virtualbox-in-terminal-commandline/
# http://www.edwardstafford.com/2009/09/13/virtualbox-and-bridged-networking-on-a-headless-ubuntu-server-host/
# http://serverfault.com/questions/128685/how-can-i-get-the-bridged-ip-address-of-a-virtualbox-vm-running-in-headless-mode

vboxmanage createvm --name $VMNAME --register
vboxmanage modifyvm $VMNAME --ostype Ubuntu
vboxmanage modifyvm $VMNAME --memory 2000
vboxmanage storagectl $VMNAME --name SATA --add sata --controller IntelAhci --bootable on
vboxmanage storageattach $VMNAME --storagectl SATA --port 0 --device 0 --type hdd --medium "$VDI"
vboxmanage modifyvm $VMNAME --nic1 bridged --nictype1 virtio --bridgeadapter1 $HOST_ADAPTER
